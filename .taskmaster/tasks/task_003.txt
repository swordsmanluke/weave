# Task ID: 3
# Title: Enhance Compiler Upvalue Tracking
# Status: done
# Dependencies: 1
# Priority: high
# Description: Extend compiler to track upvalue declarations through multiple scope levels and generate correct upvalue indices
# Details:
Modify compiler.rs to track upvalue declarations across multiple scope levels. Enhance scope management to maintain upvalue binding information through nested function definitions. Generate correct upvalue indices for deeply nested closures. Update compile_function to properly emit upvalue capture bytecode for multi-level nesting. Ensure compiler generates correct Closure, GetUpvalue, and SetUpvalue opcodes with proper indices.

# Test Strategy:
Compiler tests for nested function compilation, verify correct bytecode generation for multi-level upvalue capture, test upvalue index correctness
